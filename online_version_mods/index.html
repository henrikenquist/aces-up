<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">


    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>

    <! -- https://github.com/pyscript/pyscript/discussions/1401 -->
    <style>
        .py-repl-run-button {
            opacity: 1
        }
    </style>

    <!--test, can be removed later-->
    <script>
        function clearOutput(divId) {
          const outputDiv = document.getElementById(divId);
          outputDiv.innerHTML = '';
        }

        function clearTerminal() {
            console.clear();
        }
        
        function clearConsole() {
            process.stdout.write("\u001b[3J\u001b[2J\u001b[1J");
            console.clear();
            }
    </script>

    <!--https://github.com/pyodide/pyodide/blob/main/src/templates/console.html-->
    <!--<script src="https://cdn.jsdelivr.net/npm/jquery.terminal@2.35.2/js/jquery.terminal.min.js"></script>-->
    <!--<script>-->
    <!--    let namespace = pyodide.globals.get("dict")();-->
    <!--    pyodide.runPython(-->
    <!--    `-->
    <!--        from pyodide.console import PyodideConsole-->
    <!--        import __main__-->
    <!--        pyconsole = PyodideConsole(__main__.__dict__)-->
    <!--        import builtins-->
    <!--        def clear_console():-->
    <!--          pyconsole.buffer = []-->
    <!--    `,-->
    <!--      { globals: namespace },-->
    <!--    );-->
    <!--    let pyconsole = namespace.get("pyconsole");-->
    <!--    let clear_console = namespace.get("clear_console");-->
    <!--    namespace.destroy();-->
    <!--</script>-->

    <link rel="icon" type="image/png" href="/img/aces_up_icon.png"/>
    <title>Aces Up Strategies</title>
  </head>

  <body>

    <section class="config">
        <py-config type="toml">
            packages = ["sqlite3", "numpy", "matplotlib"]
            [[fetch]]
            files = ["./project.py", "./aces_up_db.sqlite", "src/batch.py", "src/cards.py", "src/game.py", "src/helpers.py", "src/pile.py", "src/strategy.py", "src/database.py"]
        </py-config>

        <py-script>
            from project import main as play
            from js import prompt

            def input(p):
                return prompt(p)
            __builtins__.input = input

            def clear_el(el):
                from pyscript import Element
                Element(el).clear()
            #    el = Element("results")
            #    el.clear()
        </py-script>
    </section> <!-- config -->

    <div class="container text-center" id="logo-top">
        <h1 class="display-1 my-5">Aces Up Strategies</h1>
        <img class="rounded" src="/img/aces_up_logo_small.jpg">
    </div>

    <div class="container mt-5" id="main-content">
        <div class="row">
            <div class="col" id="left">
                <h2 class="display-5 mb-3">
                    Play the game
                </h2>

                <!--<py-repl output="results">-->
                <py-repl>
                    play()
                </py-repl>
                <!--enable when functional-->
                <button id="clearButton" onclick="clearConsole()">clear</button>

                <div class="mt-2" id="instructions">
                    <p>
                        <ul>
                            <li>Click run button (green arrow) to play.</li>
                            <li>If cell is empty, type play() and click run button.</li>
                            <li>Enter your inputs in the pop-up dialog at the top.</li>
                        </ul>
                    </p>
                    <p>
                        Default strategy: 0
                        <br /> Example strategy: 200 2
                    </p>

                    <p class="lead mt-3 mb-1">Aim</p>
                    <p>To explore which strategy (combination and order of move rules) has the best odds of winning the <em>Aces Up</em> solitaire.</p>
                    <p>See <a href="https://github.com/henrikenquist/aces-up#readme">docs</a> for more information on <em>Aces Up Strategies</em>.</p>

                    <p class="lead mt-3 mb-1">Enter the <em>Ace Strategist</em> competition</p>
                    <p>Read more and <a href="https://github.com/henrikenquist/aces-up/wiki/Ace-Strategist-Competition"> submit your strategies.</a></p>

                    <p class="lead mt-3 mb-1">Game options</p>
                    <ol>
                        <li>Play one game with default or custom strategy</li>
                        <li>Play different strategies for one deck (enter q to see results)</li>
                        <li>Play a batch or a session of batches (db updates disabled)</li>
                        <li>Batch information (sample db)</li>
                        <li>Strategy odds (sample db)</li>
                    </ol>

                    <p class="lead mt-3 mb-1">Valid strategy rules</p>
                    <table class="table table-bordered table-sm" id="rule_table">
                      <tbody>
                        <th colspan="2">Default</th>
                        <tr>
                          <td>0</td>
                          <td>... highest card from any pile</td>
                        </tr>
                    	<th colspan="2">Highest card</th>
                    	<tr>
                          <td>1 *</td>
                          <td>... highest card with card of same suit below</td>
                        </tr>
                    	<tr>
                          <td>2</td>
                          <td>... highest card from pile with largest card sum</td>
                        </tr>
                    	<tr>
                          <td>3</td>
                          <td>... highest card from smallest pile</td>
                        </tr>
                    	<tr>
                          <td>4</td>
                          <td>... highest card from largest pile</td>
                        </tr>
                    	<th colspan="2">Lowest card	</th>
                    	<tr>
                          <td>10 *</td>
                          <td>... lowest card with card of same suit below</td>
                        </tr>
                    	<tr>
                          <td>20</td>
                          <td>... lowest card from pile with largest card sum</td>
                        </tr>
                    	<tr>
                          <td>30</td>
                          <td>... lowest card from smallest pile</td>
                        </tr>
                    	<tr>
                          <td>40</td>
                          <td>... lowest card from largest pile</td>
                        </tr>
                    	<th colspan="2">Ace</th>
                    	<tr>
                          <td>100 *</td>
                          <td>... ace with card of same suit below</td>
                        </tr>
                    	<tr>
                          <td>200 *</td>
                          <td>... ace from pile with largest card sum</td>
                        </tr>
                    	<tr>
                          <td>300 *</td>
                          <td>... ace from smallest pile</td>
                        </tr>
                    	<tr>
                          <td>400 *</td>
                          <td>... ace from largest pile</td>
                        </tr>
                    	<th colspan="2">Pile size & suit below</th>
                    	<tr>
                          <td>800 *</td>
                          <td>... from smallest pile with higher card of same suit below</td>
                        </tr>
                    	<tr>
                          <td>810 *</td>
                          <td>... from smallest pile with lower card of same suit below</td>
                        </tr>
                    	<tr>
                          <td>900 *</td>
                          <td>... from largest pile with higher card of same suit below</td>
                        </tr>
                    	<tr>
                          <td>910 *</td>
                          <td>... from largest pile with lower card of same suit below</td>
                        </tr>
                    	<th colspan="2">Random</th>
                    	<tr>
                          <td>1000</td>
                          <td>... card from random pile</td>
                        </tr>
                      </tbody>
                    </table>
                    <p>&#42; Doesn&#39;t guarantee a move (<a href="https://github.com/henrikenquist/aces-up#rules">more info</a>).</p>

                    <p class="lead mt-3 mb-1">Coming features</p>
                    <ul>
                        <li>Batch progress bar could be nice...</li>
                        <li>Complete outputs & 'Clear results' button after <a href="https://github.com/pyscript/pyscript/discussions/1421">next release</a></li>
                        <li>Scroll or reload page until then... sorry!</li>
                    </ul>

                    <p class="lead mt-3 mb-1">Notes</p>
                    <p>Chrome is recommended for this app.</p>
                    <p>This app runs on py-script.</p>
                    <p>They say:</p>
                    <p>
                        "Please be advised that PyScript is very alpha and under heavy development.
                        <br /> There are many known issues, from usability to loading times, and you should expect things to change often.
                        <br /> We encourage people to play and explore with PyScript, but at this time we do not recommend using it for production."
                    </p>
                    <p>I say:</p>
                    <p><em>Game on!</em>
                    </p>
                </div> <!-- instructions -->
            </div> <!-- left column -->

            <!-- https://github.com/pyscript/pyscript/discussions/1421 -->
            <div class="col" id="right">
                <h2 class="display-5 mb-3">
                    Results
                </h2>
                <div id="results"></div>
                    <!-- remove after release mentioned above -->
                    <py-terminal></py-terminal>
            </div> <!-- right column -->

        </div> <!-- row -->
    </div> <!-- grid -->

    <div class="container text-center my-5" id="logo-bottom">
        <img class="rounded" src="/img/aces_up_logo_small.jpg">
        <h1 class="display-1">Aces Up Strategies</h1>
    </div>

  </body>
</html>

<!--Prompt of input(prompt="..") is not shown in the browser input dialog -->
<!--https://github.com/pyodide/pyodide/issues/758-->

<!--py-config examples-->
<!--https://docs.pyscript.net/latest/reference/elements/py-config.html#use-cases-->

